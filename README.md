# ShachikuAI - è¨€ã„è¨³ç”Ÿæˆãƒ»è‡ªå‹•è¿”ä¿¡API

è³ªå•ã«å¯¾ã—ã¦ä¸å¯§ã§èª¬å¾—åŠ›ã®ã‚ã‚‹è¨€ã„è¨³ã‚’ç”Ÿæˆã—ã€çŠ¶æ³ã«å¿œã˜ãŸè‡ªå‹•è¿”ä¿¡ã‚’æä¾›ã™ã‚‹FastAPI + ãƒ­ãƒ¼ã‚«ãƒ«LLMã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³

## ğŸš€ æ–°æ©Ÿèƒ½

âœ¨ **AIè¿”ä¿¡ç”Ÿæˆæ©Ÿèƒ½ã‚’å®Ÿè£…ã—ã¾ã—ãŸï¼**
- æ—¥æœ¬èªGPT-1Bãƒ¢ãƒ‡ãƒ«ï¼ˆrinna/japanese-gpt-1bï¼‰ã«ã‚ˆã‚‹é«˜å“è³ªãªè¿”ä¿¡ç”Ÿæˆ
- ã‚„ã‚“ã‚ã‚Šæ–­ã‚‹ã€å…±æ„Ÿã™ã‚‹ã€è·é›¢ã‚’ä¿ã¤ãªã©ã€æ§˜ã€…ãªå¯¾å¿œæ–¹é‡ã«å¯¾å¿œ
- ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ©Ÿèƒ½ä»˜ãã§å®‰å®šå‹•ä½œ

## æ©Ÿèƒ½

- ğŸ“ **è¨€ã„è¨³ç”Ÿæˆ**: è³ªå•ã«å¯¾ã™ã‚‹è‡ªç„¶ã§èª¬å¾—åŠ›ã®ã‚ã‚‹è¨€ã„è¨³ã‚’ç”Ÿæˆ
- ğŸ¤– **AIè‡ªå‹•è¿”ä¿¡**: çŠ¶æ³ã«å¿œã˜ãŸé©åˆ‡ãªè¿”ä¿¡ã‚’ç”Ÿæˆï¼ˆæ–­ã‚Šã€å…±æ„Ÿã€è·é›¢ã‚’ç½®ãç­‰ï¼‰
- ğŸ§  **ãƒ­ãƒ¼ã‚«ãƒ«LLM**: æ—¥æœ¬èªå¯¾å¿œã®é«˜å“è³ªãªãƒ¢ãƒ‡ãƒ«ï¼ˆrinna/japanese-gpt-1bï¼‰
- ğŸ”§ **ãƒ•ã‚¡ã‚¤ãƒ³ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°å¯¾å¿œ**: ã‚«ã‚¹ã‚¿ãƒ ãƒ‡ãƒ¼ã‚¿ã§ã®ãƒ¢ãƒ‡ãƒ«æ”¹å–„
- ğŸŒ **FastAPI**: é«˜æ€§èƒ½ãªRESTful API
- ğŸ³ **Dockerå¯¾å¿œ**: ç°¡å˜ãªãƒ‡ãƒ—ãƒ­ã‚¤ã¨ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°
- ğŸ“Š **ä¿¡é ¼åº¦ã‚¹ã‚³ã‚¢**: ç”Ÿæˆã•ã‚ŒãŸè¿”ä¿¡ã®å“è³ªè©•ä¾¡

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ 

```
ShachikuAI/
â”œâ”€â”€ api/                    # APIãƒ¬ã‚¤ãƒ¤ãƒ¼
â”‚   â””â”€â”€ v1/
â”‚       â”œâ”€â”€ excuse_router.py
â”‚       â””â”€â”€ reply_router.py
â”œâ”€â”€ client/                 # ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãƒ¬ã‚¤ãƒ¤ãƒ¼
â”‚   â””â”€â”€ llm/
â”‚       â””â”€â”€ model_client.py
â”œâ”€â”€ service/                # ã‚µãƒ¼ãƒ“ã‚¹ãƒ¬ã‚¤ãƒ¤ãƒ¼
â”‚   â”œâ”€â”€ excuse_generation/
â”‚   â”‚   â””â”€â”€ excuse_service.py
â”‚   â””â”€â”€ reply_generation/
â”‚       â””â”€â”€ reply_service.py
â”œâ”€â”€ models/                 # ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«
â”‚   â””â”€â”€ request_models.py
â”œâ”€â”€ config/                 # è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«
â”‚   â””â”€â”€ llm/
â”‚       â””â”€â”€ fine_tune_config.py
â”œâ”€â”€ scripts/                # ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”‚   â””â”€â”€ fine_tuning/
â”‚       â”œâ”€â”€ fine_tune.py
â”‚       â””â”€â”€ run_fine_tune.sh
â”œâ”€â”€ data/                   # ãƒ‡ãƒ¼ã‚¿
â”‚   â”œâ”€â”€ training/           # ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ãƒ‡ãƒ¼ã‚¿
â”‚   â””â”€â”€ models/             # ãƒ¢ãƒ‡ãƒ«ä¿å­˜å…ˆ
â”œâ”€â”€ tests/                  # ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«
â”‚   â”œâ”€â”€ unit/
â”‚   â””â”€â”€ integration/
â”œâ”€â”€ main.py                 # ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³
â”œâ”€â”€ requirements.txt        # ä¾å­˜é–¢ä¿‚
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ docker-compose.yml
â””â”€â”€ .env                    # ç’°å¢ƒå¤‰æ•°
```

## ğŸ› ï¸ ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### å‰ææ¡ä»¶

- Python 3.8+
- CUDAå¯¾å¿œGPUï¼ˆæ¨å¥¨ã€CPUã§ã‚‚å‹•ä½œå¯èƒ½ï¼‰
- 8GBä»¥ä¸Šã®RAM
- 10GBä»¥ä¸Šã®ç©ºããƒ‡ã‚£ã‚¹ã‚¯å®¹é‡

### 1. ãƒªãƒã‚¸ãƒˆãƒªã®ã‚¯ãƒ­ãƒ¼ãƒ³

```bash
git clone https://github.com/your-username/ShachikuAI.git
cd ShachikuAI
```

### 2. ä»®æƒ³ç’°å¢ƒã®ä½œæˆï¼ˆæ¨å¥¨ï¼‰

```bash
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate
```

### 3. ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
pip install -r requirements.txt
```

### 4. ç’°å¢ƒå¤‰æ•°ã®è¨­å®š

`.env`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†ï¼ˆåˆå›èµ·å‹•æ™‚ã«è‡ªå‹•çš„ã«ãƒ¢ãƒ‡ãƒ«ãŒãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¾ã™ï¼‰ï¼š

```env
# ãƒ¢ãƒ‡ãƒ«è¨­å®š
MODEL_NAME=rinna/japanese-gpt-1b
MODEL_PATH=./data/models/japanese-reply-model-1b

# ç”Ÿæˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
MAX_LENGTH=512
TEMPERATURE=0.7
TOP_P=0.9

# APIè¨­å®š
API_HOST=0.0.0.0
API_PORT=8000

# ãƒ•ã‚¡ã‚¤ãƒ³ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°è¨­å®š
FINE_TUNE_ENABLED=true
FINE_TUNE_DATA_PATH=./data/training/excuses.jsonl
```

### 5. ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ã®æº–å‚™

```bash
mkdir -p data/models data/training
```

### 6. APIã®èµ·å‹•

```bash
# é–‹ç™ºãƒ¢ãƒ¼ãƒ‰ï¼ˆè‡ªå‹•ãƒªãƒ­ãƒ¼ãƒ‰ä»˜ãï¼‰
python main.py

# ã¾ãŸã¯ uvicorn ã§ç›´æ¥èµ·å‹•
uvicorn main:app --host 0.0.0.0 --port 8000 --reload
```

### 7. å‹•ä½œç¢ºèª

```bash
# ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
curl http://localhost:8000/health

# API ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã‚¢ã‚¯ã‚»ã‚¹
open http://localhost:8000/docs
```

### 8. Docker ã§ã®èµ·å‹•ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

```bash
docker-compose up --build
```

## âš ï¸ é‡è¦ãªæ³¨æ„äº‹é …

1. **åˆå›èµ·å‹•æ™‚**: æ—¥æœ¬èªGPT-1Bãƒ¢ãƒ‡ãƒ«ï¼ˆç´„5GBï¼‰ãŒè‡ªå‹•çš„ã«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¾ã™
2. **ãƒ¡ãƒ¢ãƒªè¦ä»¶**: GPUãƒ¡ãƒ¢ãƒª4GBä»¥ä¸Šæ¨å¥¨ã€CPUã®å ´åˆã¯8GBä»¥ä¸Šã®RAM
3. **ãƒ¢ãƒ‡ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«**: `.gitignore`ã«ã‚ˆã‚Šãƒ¢ãƒ‡ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã¯Gitã§ç®¡ç†ã•ã‚Œã¾ã›ã‚“
4. **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**: æœ¬ç•ªç’°å¢ƒã§ã¯`.env`ãƒ•ã‚¡ã‚¤ãƒ«ã®æ¨©é™è¨­å®šã«æ³¨æ„ã—ã¦ãã ã•ã„

## APIåˆ©ç”¨æ–¹æ³•

### è¨€ã„è¨³ç”Ÿæˆã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

```bash
curl -X POST "http://localhost:8000/v1/excuse/generate" \
     -H "Content-Type: application/json" \
     -d '{
       "question": "ãªãœé…åˆ»ã—ãŸã®ã§ã™ã‹ï¼Ÿ",
       "max_length": 512,
       "temperature": 0.7,
       "top_p": 0.9
     }'
```

ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¾‹ï¼š
```json
{
  "question": "ãªãœé…åˆ»ã—ãŸã®ã§ã™ã‹ï¼Ÿ",
  "excuse": "ç”³ã—è¨³ã”ã–ã„ã¾ã›ã‚“ã€é›»è»Šã®é…å»¶ã«ã‚ˆã‚Šåˆ°ç€ãŒé…ã‚Œã¦ã—ã¾ã„ã¾ã—ãŸã€‚ä»Šå¾Œã¯ä½™è£•ã‚’æŒã£ã¦å‡ºç™ºã„ãŸã—ã¾ã™ã€‚",
  "confidence": 0.9
}
```

### è‡ªå‹•è¿”ä¿¡ç”Ÿæˆã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

```bash
curl -X POST "http://localhost:8000/shatiku-ai/generate-reply" \
     -H "Content-Type: application/json" \
     -d '{
       "settings": {
         "userId": "user123",
         "channel": "general",
         "replyTo": "user456"
       },
       "mission": {
         "instruction": "ã‚„ã‚“ã‚ã‚Šæ–­ã‚‹",
         "goal": "æ–­ã‚‹"
       },
       "message": {
         "content": "é£²ã¿ä¼šã«å‚åŠ ã—ã¾ã›ã‚“ã‹ï¼Ÿ",
         "timestamp": "2024-01-01T12:00:00Z"
       }
     }'
```

ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¾‹ï¼š
```json
{
  "reply": "ãŠå¿™ã—ã„ä¸­ã”é€£çµ¡ã„ãŸã ãã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚ç”³ã—è¨³ã”ã–ã„ã¾ã›ã‚“ãŒã€ä»Šå›ã¯éƒ½åˆãŒã¤ã‹ãªã„ãŸã‚å‚åŠ ãŒé›£ã—ã„çŠ¶æ³ã§ã™ã€‚ã¾ãŸã®æ©Ÿä¼šãŒã”ã–ã„ã¾ã—ãŸã‚‰ã€ãœã²ã‚ˆã‚ã—ããŠé¡˜ã„ã„ãŸã—ã¾ã™ã€‚",
  "replyAt": "2024-01-01T12:00:00Z"
}
```

### ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯

```bash
curl http://localhost:8000/health
curl http://localhost:8000/v1/excuse/health
curl http://localhost:8000/shatiku-ai/health
```

## ãƒ•ã‚¡ã‚¤ãƒ³ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°

### 1. ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ãƒ‡ãƒ¼ã‚¿ã®æº–å‚™

`data/training/excuses.jsonl`ã«ä»¥ä¸‹ã®å½¢å¼ã§ãƒ‡ãƒ¼ã‚¿ã‚’è¿½åŠ ï¼š

```json
{"question": "è³ªå•æ–‡", "excuse": "è¨€ã„è¨³æ–‡"}
```

### 2. ãƒ•ã‚¡ã‚¤ãƒ³ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°ã®å®Ÿè¡Œ

```bash
./scripts/run_fine_tune.sh
```

ã¾ãŸã¯

```bash
python scripts/fine_tuning/fine_tune.py
```

### 3. ãƒ•ã‚¡ã‚¤ãƒ³ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°å¾Œã®ãƒ¢ãƒ‡ãƒ«åˆ©ç”¨

`.env`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ›´æ–°ï¼š

```env
MODEL_NAME=./data/models/fine_tuned
```

## APIä»•æ§˜

### POST /v1/excuse/generate

è¨€ã„è¨³ã‚’ç”Ÿæˆã—ã¾ã™ã€‚

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ:**
- `question` (string, required): è³ªå•æ–‡
- `max_length` (int, optional): æœ€å¤§ç”Ÿæˆé•· (default: 512)
- `temperature` (float, optional): ç”Ÿæˆã®å‰µé€ æ€§ (default: 0.7)
- `top_p` (float, optional): æ ¸ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚° (default: 0.9)

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹:**
- `question` (string): å…¥åŠ›ã•ã‚ŒãŸè³ªå•
- `excuse` (string): ç”Ÿæˆã•ã‚ŒãŸè¨€ã„è¨³
- `confidence` (float): ä¿¡é ¼åº¦ã‚¹ã‚³ã‚¢

### POST /shatiku-ai/generate-reply

è‡ªå‹•è¿”ä¿¡ã‚’ç”Ÿæˆã—ã¾ã™ã€‚

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ:**
- `settings` (object, required): è¨­å®šæƒ…å ±
  - `userId` (string): ãƒ¦ãƒ¼ã‚¶ãƒ¼ID
  - `channel` (string): ãƒãƒ£ãƒ³ãƒãƒ«å
  - `replyTo` (string): è¿”ä¿¡å…ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ID
- `mission` (object, required): è¿”ä¿¡ã®ãƒŸãƒƒã‚·ãƒ§ãƒ³
  - `instruction` (string): æŒ‡ç¤ºå†…å®¹ï¼ˆä¾‹: "ã‚„ã‚“ã‚ã‚Šæ–­ã‚‹", "å…±æ„Ÿ", "è·é›¢"ï¼‰
  - `goal` (string): ç›®æ¨™ï¼ˆä¾‹: "æ–­ã‚‹"ï¼‰
- `message` (object, required): ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æƒ…å ±
  - `content` (string): ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å†…å®¹
  - `timestamp` (datetime): ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹:**
- `reply` (string): ç”Ÿæˆã•ã‚ŒãŸè¿”ä¿¡
- `replyAt` (datetime): è¿”ä¿¡æ™‚åˆ»

### GET /shatiku-ai/health

è‡ªå‹•è¿”ä¿¡ã‚µãƒ¼ãƒ“ã‚¹ã®ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã‚’è¡Œã„ã¾ã™ã€‚

## é–‹ç™º

### ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œ

```bash
pytest tests/
```

### ãƒ­ã‚°ã®ç¢ºèª

```bash
tail -f logs/app.log
```

## ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

MIT License